---

- hosts: openvpn
  gather_facts: false

  tasks:
    - name: Wait until SSH is available on nodes
      # wait_for doesn't work properly through the Bastion
      local_action: "raw ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no ubuntu@{{ ansible_ssh_host }} '# Connected'"
      register: result
      changed_when: False
      until: result.stdout.find("OpenSSH") == -1
      retries: 10
      delay: 30

    - name: Install Python
      raw: "apt-get -y -q install python"
      become: true
      retries: 10
      delay: 30
